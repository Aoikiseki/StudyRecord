## 查字典

1. 修改首页滑动效果

## 识字



待完成：

1. 听写拍照检查结果页面的横竖屏旋转问题



@State

@AppStorage
通过UserDefault存取值，每次值被更改，swiftUI都会对view invalidate一下重新绘制



## iOS动画

### 基础知识

单一责任：UIView持有CALayer，UIView负责创建和管理CALayer、处理用户交互，CALayer负责显示内容

LayerTree？PresentationTree？RenderTree？

Hit test调用顺序：touch -> UIApplication -> UIWindow -> UIViewController -> UIView -> subview -> 合适的view

事件传递顺序刚好相反：如果当前view无法处理，则交给superview处理，到UIApplication都无法处理则丢弃

UIView什么时候不响应事件？

1. view.userInteractionEnabled = false
2. view.isHidden = true
3. view.alpha < 0.05
4. view.bounds超过superview

因此在自己写hittest的时候**必须**首先将上面1～3考虑到，然后递归subview判断，首先进行point的坐标转换，将point转换为每个subview的坐标系，然后调用subview的hittest，最后如果为nil说明当前point不在当前view下。

应用场景：事件穿透

子view的bounds超出了superview，但是还想触发点击事件

### 属性动画CAPropertyAnimation

CAPropertyAnimation、CATransition、CAAnimationGroup都是CAAnimation子类，其中CATransition是苹果封装好的动画，可以直接用

CAPropertyAnimation通过修改属性完成动画，常用的CABasicAnimation和CAKeyframeAnimation都是属性动画

通过修改属性

```swift
let animation = CABasicAnimation()
animation.kayPath = "position.y"
animation.toValue = 400
```

| 属性                | 含义                                                         |
| ------------------- | ------------------------------------------------------------ |
| keyPath             | 需要修改的属性值，字符串形式                                 |
| toValue             | 对于keyPath的值，在当前值基础上的偏移量                      |
| duration            | 持续时间                                                     |
| removedOnCompletion | 动画结束后是否移除，默认true                                 |
| fillMode            | `forwards`：动画结束后，layer保持动画最后的状态<br />`backwards`：动画开始前，就会进入动画第一帧的状态<br />`both`：`forwards` & `backwards`<br />`removed`：动画结束后对原始的layer没有影响，直接移除 |
|                     |                                                              |
|                     |                                                              |
|                     |                                                              |
|                     |                                                              |

对于一个View依据不同环境要进行不同动画，可以先创建出所有的animation，通过参数判断add哪一个animation

### 动画结束后复原问题

确保下面两个属性设置正确

```swift
animation.removedOnCompletion = false
animation.fillMode = .forwards
```

动画是在PresentationTree中进行移动，当移动完如果`removedOnCompletion = true`则动画消失，原始的Layer显示出来，因此动画结束后会回到原先的位置

### 隐式动画

`CATransaction`用来控制隐式动画，该类型只有类方法，使用方式类似数据库：

1. CATransaction.begin
2. 修改隐式动画的属性（比如持续时间）
3. 加入目标动画（比如改变颜色）
4. CATransaction.commit

```swift
CATransaction.begin
CATransaction.setAnimationDuration = 1.0
/*
在此处加入想要执行的动画
*/
CATransaction.commit
```

