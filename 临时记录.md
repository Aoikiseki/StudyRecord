## 识字

1. 视频播放页左上角标注当前学习的字（见UI稿）
2. 首页单元卡片阴影



@State

@AppStorage
通过UserDefault存取值，每次值被更改，swiftUI都会对view invalidate一下重新绘制



## iOS动画

### 动画组

https://www.jianshu.com/p/1a2ad3711726

### 核心动画

https://www.jianshu.com/p/d05d19f70bac

https://juejin.im/post/6844903762364989448

https://www.jianshu.com/p/a079a9bb20f9

https://www.jianshu.com/p/f2def3da931f

### 动画之间设置延迟

https://www.coder.work/article/416046

### 关键帧动画

http://i-swift.ir/en/blog/2018/11/16/keyframe-animations/

### 基础知识

单一责任：UIView持有CALayer，UIView负责创建和管理CALayer、处理用户交互，CALayer负责显示内容

LayerTree？PresentationTree？RenderTree？

Hit test调用顺序：touch -> UIApplication -> UIWindow -> UIViewController -> UIView -> subview -> 合适的view

事件传递顺序刚好相反：如果当前view无法处理，则交给superview处理，到UIApplication都无法处理则丢弃

UIView什么时候不响应事件？

1. view.userInteractionEnabled = false
2. view.isHidden = true
3. view.alpha < 0.05
4. view.bounds超过superview

因此在自己写hittest的时候**必须**首先将上面1～3考虑到，然后递归subview判断，首先进行point的坐标转换，将point转换为每个subview的坐标系，然后调用subview的hittest，最后如果为nil说明当前point不在当前view下。

应用场景：事件穿透

子view的bounds超出了superview，但是还想触发点击事件

### 属性动画CAPropertyAnimation

CAPropertyAnimation、CATransition、CAAnimationGroup都是CAAnimation子类，其中CATransition是苹果封装好的动画，可以直接用

CAPropertyAnimation通过修改属性完成动画，常用的CABasicAnimation和CAKeyframeAnimation都是属性动画

通过修改属性

```swift
let animation = CABasicAnimation()
animation.kayPath = "position.y"
animation.toValue = 400
```

| 属性                | 含义                                                         |
| ------------------- | ------------------------------------------------------------ |
| keyPath             | 需要修改的属性值，字符串形式                                 |
| toValue             | 对于keyPath的值，在当前值基础上的偏移量                      |
| duration            | 持续时间                                                     |
| removedOnCompletion | 动画结束后是否移除，默认true                                 |
| fillMode            | `forwards`：动画结束后，layer保持动画最后的状态<br />`backwards`：动画开始前，就会进入动画第一帧的状态<br />`both`：`forwards` & `backwards`<br />`removed`：动画结束后对原始的layer没有影响，直接移除 |
|                     |                                                              |
|                     |                                                              |
|                     |                                                              |
|                     |                                                              |

对于一个View依据不同环境要进行不同动画，可以先创建出所有的animation，通过参数判断add哪一个animation

### 动画结束后复原问题

确保下面两个属性设置正确

```swift
animation.removedOnCompletion = false
animation.fillMode = .forwards
```

动画是在PresentationTree中进行移动，当移动完如果`removedOnCompletion = true`则动画消失，原始的Layer显示出来，因此动画结束后会回到原先的位置

### 隐式动画

`CATransaction`用来控制隐式动画，该类型只有类方法，使用方式类似数据库：

1. CATransaction.begin
2. 修改隐式动画的属性（比如持续时间）
3. 加入目标动画（比如改变颜色）
4. CATransaction.commit

```swift
CATransaction.begin
CATransaction.setAnimationDuration = 1.0
/*
在此处加入想要执行的动画
*/
CATransaction.commit
```

### RxSwift的性能问题？

### CGAffineTransform

https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/83-%E5%88%A9%E7%94%A8-cgaffinetransform-%E7%B8%AE%E6%94%BE-%E4%BD%8D%E7%A7%BB%E5%92%8C%E6%97%8B%E8%BD%89-e061df9ed672

### 判断是什么设备

```swift
UIDevice.current.model == "iPad"
```

### 镜像翻转动画

```swift
let animationMirror = CABasicAnimation(keyPath: "transform.scale.x")
animationMirror.beginTime = 1.0
animationMirror.toValue = 1
animationMirror.duration = 0.1
animationMirror.fillMode = .forwards
animationMirror.isRemovedOnCompletion = false
animations.append(animationMirror)
```

### 小车动画重复的动画被覆盖了（比如两次RightDown）？

layer.add(​ : key:)key设置为nil即可，否则动画会被覆盖

### collectionView滑动到指定cell（该cell置顶）

```swift
collectionView.selectItem(at: IndexPath(item: index, section: 0), animated: true, scrollPosition: .top)
```

### scrollView的contentSize怎么设置？

1. 手动设置（不建议）
2. 通过设置里面view的edges+width、height

### 增加动画后，无法触发点击事件，看options参数

```swift
UIView.animateKeyframes(withDuration: , delay: , options: , animations: , completion: )
```

PS：是否递归？

### 部分设置字符串的颜色

```swift
if let fullTitleString = wordLabel.text {
    wordLabel.textColor = UIColor.leo_title
    let rangeOfColoredString = (fullTitleString as NSString).range(of: learnedWord.joined())
    let attributedString = NSMutableAttributedString(string: fullTitleString)
    attributedString.setAttributes([NSAttributedString.Key.foregroundColor: UIColor.leo_yellowTitle], range: rangeOfColoredString)
    wordLabel.attributedText = attributedString
}
```



### Git

1. develop分支上提交commit
2. develop分支上切出feature分支
3. develop分支对commit revert
4. feature cherry-pick commit
5. feature merge到develop（反过来也可以）

结果：merge后是否存在commit?



### Bundle

Bundle.main

提供访问当前运行中的可执行文件（executable）目录的方式，如果运行中的是app，则访问app的bundle目录，如果运行中的是framework，则访问framework的bundle目录



### 播放音频

```swift
if let resourceURL = Bundle.main.url(forResource: "ChineseDictationCompelete", withExtension: "mp3") {
    voiceOverPlayer = try? AVAudioPlayer(contentsOf: resourceURL)
    voiceOverPlayer?.play()
}
```



### 回到指定VC

```swift
if let viewControllers = self.navigationController?.viewControllers {
    for viewController in viewControllers {
        if viewController.isKind(of: isUnitFinalWord ? LiteracyHomeViewController.self : LiteracyWordMapViewController.self) {
          self.navigationController?.popToViewController(viewController, animated: true)
          break
        }
    }
}
```



### 加下方二维码

```swift
func generateQRSnapshot() -> UIImage? {
    guard let snapshot = generateSnapshot(),
    ImageUtils.isImageValid(snapshot) else { return nil }
    let qrCodeViewSize = CGSize(width: snapshot.size.width, height: 82.0)
    let qrCodeCell = ShareLogoCell(frame: .init(origin: .zero, size: qrCodeViewSize))
    qrCodeCell.bindData(with: .init(qrCodeImage: UIImage(named: "finish_share_QR")))
    let qrCodeViewImage = qrCodeCell.leo.snapshot()

    UIGraphicsBeginImageContextWithOptions(.init(width: snapshot.size.width, height: snapshot.size.height + qrCodeViewSize.height), false, UIScreen.main.scale)
    defer { UIGraphicsEndImageContext() }
    snapshot.draw(in: .init(origin: .zero, size: snapshot.size))
    qrCodeViewImage?.draw(in: .init(origin: .init(x: 0, y: snapshot.size.height), size: qrCodeViewSize))
    return UIGraphicsGetImageFromCurrentImageContext()
}
```



### 多行文本label

```swift
userLabel.lineBreakMode = .byWordWrapping
userLabel.numberOfLines = 0
```



### 视频播放

HLS：HTTP Live Streaming

KVO：Key-value observing

`AVAsset`

声明播放资源的抽象接口，只存储媒体资源的静态信息，比如时长和创建时间，可以使用AVAsset的init创建不同的子类，比如传入URL创建`AVURLAsset`

`AVPlayerItem`

持有`AVAsset`对象，用于管理`AVAsset`的状态和播放时间，可以观察其加载状态属性`status`，资源未加载为`AVPlayerItem.Status.unknown`，`AVPlayer`需要等待`AVPlayerItem.status`切换为`AVPlayerItem.Status.readyToPlay`才会将该资源加入队列等待播放

`AVPlayer`

用来管理媒体资源的播放和时间，通过`currentItem`获取当前正在播放的Item，可以通过`replaceCurrentItem`方法切换播放对象，同一时刻播放一个`AVPlayerItem`。`AVPlayer`的子类`AVQueuePlayer`可以持有多个Items，从而管理视频序列的播放。

`rate`：播放视频的速度，0.0暂停视频，1.0正常速率

其他正值有效性需要依赖`AVPlayerItem`的`canPlaySlowForward`、`canPlayFastForward`

负数有效性依赖`canPlayReverse`、`canPlaySlowReverse`、`canPlayFastReverse`

`AVPlayer`是非可视的对象，无法对资源进行呈现，需要依赖`AVPlayerLayer`或者`AVKit`，如果需要添加与`AVPlayerItem`时间同步的动画等，可以使用`AVSynchronizedLayer`

`AVKit`：可以创建`AVPlayerViewController`（iOS、tvOS）、`AVPlayerView`（macOS），这些内置类自带播放控制控件

`AVPlayerLayer`

只提供对视频内容的展示，不提供任何内置的播放控制控件，可以用于创建自定义的播放界面

### AVPlayer可以通过URL播放视频和音频，AVAudioPlayer只能播放本地音频

### FrogConstants

写enum不写struct，因为写enum里面没有case就无法被实例化，防止该类被实例化



### RxSwift

自己Observe自己的属性产生引用循环，内存泄漏



### KVO

https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html

https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-BAJEAIEE

继承自NSObject则该对象和属性自动就是KVO适配的



### 创建可读性更高的多行字符串

```swift
let multilineString = "first line\nsecond line\nthird line" 
let betterMultilineString = [
  "first line",
  "second line",
  "third line"
].joined(separator: "\n")
```



### View缩放

```swift
self.view.transform = CGAffineTransformScale(CGAffineTransformIdentity, 2, 2);
```



anchorPoint、position、frame

https://www.cnblogs.com/Free-Thinker/p/11269662.html